language: php

matrix:
  include:
    - language: php
      php:
        - '7.1'
        - '7.2'
        - nightly
    - language: go
      go:
        - "1.x"
    - language: node_js
      node_js:
        - "node"

before_script:
    # To be removed when this issue will be resolved: https://github.com/composer/composer/issues/5355
    - go get -u github.com/fogleman/primitive
    - npm install -g sqip
    - composer update --prefer-dist --no-interaction --prefer-stable --quiet
    - composer update ${COMPOSER_FLAGS} --prefer-dist --no-interaction
    - ./vendor/bin/simple-phpunit install

script:
    - composer validate --strict --no-check-lock
    # simple-phpunit is the PHPUnit wrapper provided by the PHPUnit Bridge component and
    # it helps with testing legacy code and deprecations (composer require symfony/phpunit-bridge)
    - ./vendor/bin/simple-phpunit $PHPUNIT_FLAGS
    - composer run code-sniffer
    - composer run test
    - composer run static-analysis
    - composer run mess-detector

after_success:
  - travis_retry php vendor/bin/php-coveralls -v